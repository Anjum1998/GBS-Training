from fastapi import FastAPI, Form, Request
from fastapi.responses import HTMLResponse
from fastapi.templating import Jinja2Templates
import joblib
import numpy as np
from sklearn.ensemble import RandomForestClassifier
from sklearn.datasets import load_iris
from sklearn.model_selection import train_test_split

app = FastAPI(title='Iris RF Demo')
templates = Jinja2Templates(directory="templates")

# Load model
try:
    model = joblib.load('artifacts/rf_iris.joblib')
except:
    iris = load_iris()
    X_train, X_test, y_train, y_test = train_test_split(
        iris.data, iris.target, test_size=0.2, random_state=42)
    model = RandomForestClassifier(n_estimators=10, random_state=42)
    model.fit(X_train, y_train)

# Map species to image URLs
species_images = {
    "setosa": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR4tl_caOBTlHWed3b_6hd4hEa7QhQxyaOxFg&s",
    "versicolor": "data:image/jpeg;base64,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",
    "virginica": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQL5fm2JL5v2ursRJW96BDOypUDSXaV6Qbz0g&s"
}

# Home page with HTML form
@app.get("/", response_class=HTMLResponse)
def home(request: Request):
    return templates.TemplateResponse("index.html", {"request": request})

# Form submission route
@app.post("/predict_form", response_class=HTMLResponse)
def predict_form(
    request: Request,
    sepal_length: float = Form(...),
    sepal_width: float = Form(...),
    petal_length: float = Form(...),
    petal_width: float = Form(...),
):
    data = np.array([[sepal_length, sepal_width, petal_length, petal_width]])
    pred_idx = model.predict(data)[0]

    # Map numeric label to species name
    target_names = load_iris().target_names
    prediction = target_names[pred_idx]

    # Pick image URL for the predicted species
    image_url = species_images.get(prediction, None)

    return templates.TemplateResponse(
        "index.html",
        {"request": request, "prediction": prediction, "image_url": image_url}
    )


# from fastapi import FastAPI, Form, Request
# from fastapi.responses import HTMLResponse
# from fastapi.templating import Jinja2Templates
# import joblib
# import numpy as np
# from sklearn.ensemble import RandomForestClassifier
# from sklearn.datasets import load_iris
# from sklearn.model_selection import train_test_split

# app = FastAPI(title='Iris RF Demo')
# templates = Jinja2Templates(directory="templates")

# # Load model
# try:
#     model = joblib.load('artifacts/rf_iris.joblib')
# except:
#     iris = load_iris()
#     X_train, X_test, y_train, y_test = train_test_split(
#         iris.data, iris.target, test_size=0.2, random_state=42)
#     model = RandomForestClassifier(n_estimators=10, random_state=42)
#     model.fit(X_train, y_train)

# # Home page with HTML form
# @app.get("/", response_class=HTMLResponse)
# def home(request: Request):
#     return templates.TemplateResponse("index.html", {"request": request})

# # Form submission route
# @app.post("/predict_form", response_class=HTMLResponse)
# def predict_form(
#     request: Request,
#     sepal_length: float = Form(...),
#     sepal_width: float = Form(...),
#     petal_length: float = Form(...),
#     petal_width: float = Form(...),
# ):
#     data = np.array([[sepal_length, sepal_width, petal_length, petal_width]])
#     pred_idx = model.predict(data)[0]

#     # Map numeric label to species name
#     target_names = load_iris().target_names
#     prediction = target_names[pred_idx]

#     return templates.TemplateResponse("index.html", {"request": request, "prediction": prediction})
